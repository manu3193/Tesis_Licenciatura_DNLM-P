\chapter{Marco teórico}
\label{ch:marco}

%\section{Descripción}
%
%Toda tesis hace referencia a trabajos previos en el área y trabajos afines que
%están directamente relacionados con lo planteado en el tesis.
%
%Además, en el marco teórico debe aparecer la información absolutamente
%necesaria para comprender la solución, y por eso es recomendable escribir
%primero la solución (el siguiente capítulo), para ir anotando qué debe ser
%explicado en el marco teórico.
%
%\section{Generalidades}
%
%Se recomienda revisar las guías de publicación de la \nt{IEEE} en
%\url{http://www.ieee.org/publications_standards/publications/authors/authors_journals.html},
%donde puede encontrar cómo hacer referencias bibliográficas correctamente, cómo
%citar ecuaciones, tablas y figuras, etc.  
%
%\subsection{Redacción}
%
%La \nt{redacción} en todo el documento debe seguir un estilo científico
%objetivo. Esto implica que se redacta de modo impersonal, sin utilizar primeras
%personas del singular o del plural, y se evita el uso de cualquier tipo de
%calificativo, sustituyéndolos siempre por datos concretos, vinculados a
%referencias bibliográficas o datos experimentales. Los comparativos también
%deben concretarse a hechos y datos, y nunca dejarse ``en el aire''. Por la
%naturaleza de la tesis, el tiempo verbal es usualmente presente, no perdiendo
%nunca de vista que se está explicando ``cómo hacer algo'', en vez de ``qué se
%hizo''.
%
%Las \nt{frases} deben ser cortas, y debe evitarse que el lector tenga que saltar
%constantemente entre partes de la tesis, lo que implica una exposición lineal
%clara, donde lo que se necesita ya ha sido explicado antes. Deben evitarse
%redundancias y por tanto cada concepto se exponen en un único lugar.
%
%Todo aspecto circunstancial es irrelevante para la tesis, es decir, si se ha
%desarrollado en el laboratorio $X$, o en el curso $Y$, con el profesor $Z$, o
%en la empresa $W$, el nombre de funciones o clases en su código, etc., es
%información irrelevante para reproducir el experimento, y por lo tanto sobra.
%
%\subsubsection{Numeración del documento}
%
%La primera página de la tesis es la correspondiente a la introducción,
%así que ésta debe ser la página 1. Desde la introducción, hasta antes
%de la bibliografía, las unidades son ``Capítulos''. La bibliografía y
%anexos no se consideran capítulos, así que ya no continúan con la
%misma numeración de los capítulos (la paginación sí continua). Los
%índices, notación, glosario, etc.\ se numeran con números romanos en
%versalitas ({\textsc{I}, \textsc{II}, \textsc{III}, \textsc{IV},
%  \textsc{V}, \textsc{VI}}$\ldots$) y antes del índice (portada,
%resúmenes, agradecimientos, hoja de evaluadores, etc.) las páginas no
%llevan numeración.
%
%Esta plantilla LaTeX ya se ocupa de todo lo anterior.
%
%\subsection{Ecuaciones}
%
%Para citar \nt{ecuaciones} se utilizan paréntesis redondos, y no es
%necesario emplear explícitamente la palabra ``ecuación''. Por ejemplo
%``Introduciendo en (4.2) los resultados de (3.3) y (3.7) se obtiene
%...''. La ecuación es parte del flujo de texto y no un objeto
%flotante, así que no pueden emplearse como figuras. Cuando se requiere
%la ecuación, allí se inserta.
%
%Es incorrecto redactar de la siguiente forma: \explain{MAL}
%
%\textsl{La operación del transistor sin tomar en cuenta el efecto Early está
%  dada por (\ref{eq:ej1}), donde el parámetro $\kappa$ está dado por
%  (\ref{eq:ej2}).}
%
%\begin{equation} \label{eq:ej1}
%  I_{DS}
%  =
%  I_{n0} \frac{W}{L}e^{\kappa \frac{V_{GB}}{v_t}}
%  \left[
%    e^{-\frac{V_{SB}}{v_t}}
%    -
%    e^{-\frac{V_{DB}}{v_t}}
%  \right]
%\end{equation}
%
%\begin{equation} \label{eq:ej2}
%  \kappa = \frac{C_{ox}}{C_{ox}+C_{dep}}
%\end{equation}
%
%Lo anterior es incorrecto porque obliga al lector a estar buscando ecuaciones,
%que pueden mostrarse directamente.  La única referenciación permitida es hacia
%atrás.
%
%La forma correcta de redactar lo anterior es: \chk{BIEN}
%
%\textsl{La operación del transistor sin tomar en cuenta el efecto Early está
%  dada por}
%\begin{equation} \label{eq:ej3}
%  I_{DS}
%  =
%  I_{n0} \frac{W}{L}e^{\kappa \frac{V_{GB}}{v_t}}
%  \left[
%    e^{-\frac{V_{SB}}{v_t}}
%    -
%    e^{-\frac{V_{DB}}{v_t}}
%  \right]
%\end{equation}
%\textsl{donde el parámetro $\kappa$ es}
%\begin{equation} \label{eq:ej4}
%  \kappa = \frac{C_{ox}}{C_{ox}+C_{dep}}
%\end{equation}
%
%Así el flujo del texto guía al lector por las ecuaciones sin mayor esfuerzo.
%
%Es recomendable numerar \emph{todas} las ecuaciones, de modo que en la revisión
%del documento, o en futuras referencias a su documento de tesis todas las
%ecuaciones puedan ser citadas sin requerir describir textualmente a cuál
%ecuación se está haciendo referencia.
%
%\subsection{Figuras}
%
%Para el almacenamiento de imágenes existen dos tipos de formato: las imágenes
%raster y las imágenes vectoriales.\index{imagen!raster}
%
%\subsubsection{Imágenes raster}
%
%Las imágenes raster son representadas por una rejilla de píxeles, en donde cada
%píxel tiene un valor que representa al nivel de gris o el color. La
%discretización espacial es ineludible, y la única forma de obtener buena
%calidad es empleando tamaños grandes de la imagen que conduzcan a resoluciones
%de al menos 300 puntos por pulgada en la impresión, lo que conlleva a archivos
%de documentos de varios megabytes. Dentro de los formatos para almacenar
%imágenes raster existen algunos con pérdida (como el JPEG) que producen en
%imágenes sintéticas, como diagramas, estructuras ruidosas que dan una
%apariencia de baja calidad a las figuras. Otros formatos (como PNG, BMP, TIFF o
%GIF) no tiene pérdidas de información, pero los algoritmos de compresión no
%pueden reducir el tamaño de las imágenes con los mismos factores de reducción
%que los formatos con pérdidas. Este tipo de formatos debe utilizarse únicamente
%para fotografías o capturas de escenas reales con cámaras digitales.
%
%\subsubsection{Imágenes vectoriales}
%
%\index{imagen!vectorial}
%Las imágenes vectoriales \textbf{deben} ser empleadas en todo tipo de
%diagrama. En ellas no se almacenan píxeles, sino las estructuras geométricas
%que componen la figura como círculos (representado por posicion de su centro y
%su radio), rectángulos (representados por sus esquinas), líneas, texto, etc. La
%mayoría de programas para elaborar este tipo de diagramas, como Inkscape, XFig,
%OpenOffice.org Draw, MS Visio, Adobe Illustrator, etc. proveen varios formatos
%vectoriales que pueden ser insertados tanto en LaTeX como en OpenOffice.org
%Writer (o MS Word). Los formatos más empleados son los llamados metafiles, que
%incluyen al WMF, EMF. En LaTeX se utiliza por lo general EPS. Recientemente se
%ha incrementado el soporte al formato SVG.
%
%No debe cometerse el error de generar una imagen vectorial a partir de una
%imagen raster, pues una vez realizada la discretización espacial no es posible
%reconstruir los elementos geométricos que componen la imagen. Por ello, no
%tiene ningún sentido generar un archivo EPS o WMF a partir de una imagen ya
%almacenada en BMP, JPG, o PNG, pues lo único que ocurrirá es que se inserta la
%figura raster tal cual en la imagen vectorial, sin implicar ninguna ganancia en
%la calidad.
%
%Esta plantilla de LaTeX administra la generación de ciertas figuras por usted.
%Puede colocar en el directorio \texttt{fig/} archivos EPS, JPG, PNG o GP (de
%GNUPlot) y el Makefile se encarga de hacer todas las conversiones necesarias.
%En las siguientes subsecciones se describen dos casos adicionales que resultan
%útiles para realizar figuras más complejas.
%
%\subsubsection{Figuras ltxfig/psfrag}
%
%\index{psfrag}\index{ltxfig}
%Cuando en el subdirectorio \texttt{fig/} se encuentran dos archivos con el
%mismo nombre pero extensiones \texttt{ltxfig} y \texttt{psfrag}, por ejemplo
%\texttt{prueba.ltxfig} y \texttt{prueba.psfrag}, entonces el Makefile asume que
%usted desea crear una figura a partir del archivo \texttt{prueba.ltxfig},
%creado con el programa \texttt{XFig}, sustituyendo los textos ahí presentes con
%texto formateado con LaTeX.
%
%La figura~\ref{fig:ltxfig} ha sido creada con este esquema.  Revise los
%archivos correspondientes en el directorio de figuras
%\texttt{fig/ltxfig\_prototipo.*} para más detalles sobre su uso.
%
%\begin{figure}[htb]
%  \centering
%  \includegraphics[width=0.9\textwidth]{ltxfig_prototipo}
%  \caption{Ejemplo de imagen ltxfig/psfrag}
%  \label{fig:ltxfig}
%\end{figure}
%
%\subsubsection{Figuras pstricks}  
%
%\index{pstricks}
%Los archivos con extensión \texttt{.pstricks} en el directorio \texttt{fig} se
%utilizan para generar cualquier tipo de imágenes según el código que se
%contenga.  Es un concepto más general que el anterior.  La
%figura~\ref{fig:pstricks} ha sido creada con este esquema.  Puede revisar los
%archivos \texttt{prototipo\_gnuplot*} como un ejemplo de su uso, en donde de un
%archivo gnuplot (\texttt{\_.gp}) se genera un archivo \texttt{\_.eps}, el cual
%es incluido en el archivo \texttt{.pstricks} sustituyendo cadenas de texto por
%código LaTeX.
%
%\begin{figure}[htb]
%  \centering
%  \includegraphics{prototipo_gnuplot}
%  \caption{Ejemplo de imagen gnuplot/pstricks}
%  \label{fig:pstricks}
%\end{figure}
%
%\subsubsection{Entradas en el índice de figuras}
%
%El índice de figuras debe servir para encontrar rápidamente dónde se
%encuentra cierta figura.  El pie de la figura, indicado en \LaTeX con
%\texttt{caption} puede ser extenso, en especial para indicar detalles
%de las figura, y es la entrada por defecto que aparecerá en el índice
%de figuras, la cual no debe superar la extensión de una línea y debe
%únicamente dar la idea del contenido de la figura para poder ser
%encontrada.  Para lograr esto en \LaTeX{} se agrega un parámetro
%opcional con el texto del índice de la siguiente forma:
%\begin{verbatim}
%  \caption[Texto en el índice]{Texto al pie de la figura}
%\end{verbatim}
%
%\subsection{Referencias bibliográficas}
%
%\index{referencias}\index{BibTeX}
%Todo concepto o idea tomado de otros autores contar con la respectiva
%referencia. En redacción técnica de ingeniería rara vez se utiliza la cita
%textual, así que es necesario reformular las ideas y conceptos con palabras
%propias. En ingeniería electrónica se utilizan los formatos de referencia de la
%IEEE o la ACM, que son numéricos, encerrados entre paréntesis cuadrados (por
%ejemplo, ``En \cite{Davis1963} se propuso un nuevo algoritmo'', o ``En
%\cite{ProakisManolakis1998} los autores proponen tomar las ventajas de los
%algorimos presentados en \cite{Oppenheim1998,Roberts2005,Haykin2001} por medio
%del método de Newton \cite{Burrus1998} conocido en el área de optimización
%lineal.''). La referencia es parte de las frases, así que si la frase termina
%con la referencia para indicar la idea, ésta debe estar antes del punto final o
%demás signos de puntuación: ``La capacidad de memoria también sigue una Ley
%similar a la de Moore \cite{Octave}. Los siguientes son los aspectos a tomar en
%cuenta en el diseño del sistema \cite{Lindner2002}:''
%
%Se recomienda utilizar BibTeX para indicar las referencias
%bibliográficas.  Actualmente herramientas como Mendeley, Zotero u
%otras similares simplifican la administración de las referencias y
%pueden exportar al formato BibTeX.
%
%\subsection{Extensión}
%
%\index{extensión}
%Una tesis de licenciatura no debe sobrepasar las 120 páginas incluyendo
%apéndices y los formalismos desde portada hasta índices.
%
%El cuerpo de la tesis (desde introducción hasta conclusiones) usualmente se
%extiende desde 45 páginas hasta no más de 80, dependiendo de la problemática
%tratada.
%
%No es necesario reproducir contenidos de otras fuentes: agregue las referencias
%a dichas fuentes, y limítese a enunciar lo estrictamente necesario para
%comprender sus propuestas de solución.
%
%\section{Sobre esta plantilla \LaTeX}
%
%Esta plantilla \LaTeX pretende simplificar varios pasos en la creación del
%documento de tesis.
%
%\subsection{Marcar asuntos pendientes}
%
%La plantilla tiene dos ``\emph{modos}'' de operación: normal y borrador
%(\emph{draft}).  En el archivo \texttt{main.tex} a partir de la línea 41 usted
%encuentra el código
%
%\begin{verbatim}
%%
%% DRAFT MODE
%%
%\newboolean{draftmode}                  % boolean used to control draft-mode
%% Ensure that only one of the next two lines is active:
%\setboolean{draftmode}{true}            % turn draft mode on
%%\setboolean{draftmode}{false}           % turn draft mode off
%\end{verbatim}
%
%Con el modo borrador, se activan ciertos comandos y funcionalidades útiles en
%el proceso de elaboración de la tesis, pero que deben ser desactivados al
%final, antes de entregar la tesis.  Por ejemplo, se activa el pie de página que
%dice ``\emph{Borrador: fecha}'', y se activa el índice titulado ``Revisar''.  En dicho índice aparecen las páginas en donde se hayan utilizado alguno de los siguientes comandos:
%\begin{compactitem}
%\item \verb+\boxcomment{comentario}+ Crea una caja en el margen de página con
%  el comentario indicado.
%\item \verb+\explain{comentario}+ Crea una caja en el margen de página con
%  el comentario indicado, con una flecha hacia la derecha para indicar qué en
%  concreto debe ser revisado.
%\item \verb+\chk{comentario}+ Crea una caja en el margen con símbolo de
%  ``chequeado'' y el comentario indicado.
%\item \verb+\TODO{comentario}+ Crea una caja grande de fondo sombreado con el
%  comentario indicado.
%\end{compactitem}
%
%En este párrafo se\chk{resultado de chk} utilizan algunos de estos comandos
%para ilustrar su efecto.  El \verb+\chk+ como puede observar tiene sentido
%usarlo para marcar que algo está casi listo.  Por otro lado \explain{explain}
%el comando \verb+\explain+ permite marcar algo que requiere ser revisado en
%redacción, valores, etc.  El \verb+\boxcomment+\boxcomment{La caja simple}
%solo pone una marca al margen.
%
%\TODO{Finalmente el comando \texttt{TODO} coloca esta caja gris.}
%
%Si usted desativa el modo draft, desaparecen todas las marcas
%anteriores, y desaparece el índice ``Revisar''.  En éste índice
%aparecen todas las páginas en donde se utilizaron estos comandos con
%los respectivos comentarios, lo que permite encontrar rápidamente
%detalles que usted indicó que debe revisar.
%
%\subsection{Índices}
%
%Como índice se conoce la lista de términos claves con su respectiva
%página.  Usualmente aparece al final del documento.  La plantilla
%ofrece varios comandos para simplificar el uso estandar del comando de
%\LaTeX\ \verb+\index{termino}+ que coloca al término indicado en el
%índice.  Con \verb+\nt[indice]{termino}+ (\emph{new term}) usted
%indica la entrada principal del término, que aparece en el texto en el
%índice, es decir, en el índice aparece lo que indique en vez de
%``indice'' y en el texto aparece lo que indique ``termino'';
%\verb+\ot{termino}+ agrega una entrada secundaria al término.

En este cap\'itulo se detalla el contenido te\'orico necesario para el desarrollo de la propuesta presentada en este trabajo. La propuesta consiste en la paralelizaci\'on del filtro Deceived Non-Local Means (DNLM), presentado como parte de la familia de filtros DeWAFF en \cite{calderon2015dewaff}, para la eliminaci\'on de ruido, realce de bordes y mejora de contraste en la imagen. La propuesta de paralelizaci\'on incluye la evaluaci\'on de optimizaciones computacionales desarrolladas para este filtro y para el filtro Non-Local Means original (NLM) presentadas en \cite{CalderonRamirez2017} y \cite{Condat2010, Darbon2008}, por mencionar algunas.
El filtro DNLM presenta los mejores resultados en t\'erminos de relaci\'on se\~nal-ruido y conservaci\'on de bordes, al ser comparado con el filtro bilateral y el filtro bilateral escalado (ambos parte de DeWAFF) \cite{calderon2015dewaff}, ya que se basa en el efoque de eliminaci\'on de ruido por medio del ponderado no local presentado en \cite{buades2005non}. 



\subsection{Realce de detalles en imagen}\

\subsubsection{Unsharp Masking}

Para el realce de los bordes y mejora de contraste se utilza un m\'etodo de unsharp mask que realiza una substracci\'on de la imagen suavizada a la imagen original dando como resultado una imagen $B$ con las altas frecuencias de la imagen, es decir, los bordes y otros cambios considerables en la intensidad de los pixeles t\'ipicamente representados como detalles y ruido. Adicionalmente, se puede emplear un enfoque inverso que consiste en a\~nadir la imagen $B$ con la informaci\'on de bordes y detalles a la imagen original en una proporci\'on dada por el coeficiente $\lambda$, como se observa en la ecuaci\'on \ref{eq:unsharpmask}. La imagen $B$ es el producto de la convoluci\'on entre la imagen original y un kernel que aproxime la segunda derivada, como el kernel Laplaciano o Laplaciano de Gaussiano.

\begin{equation}
\label{eq:unsharpmask}
G=U+\lambda\,B
\end{equation}

donde $B$ corresponde a

\begin{equation}
\label{eq:unsharfilter}
B=l*U
\end{equation}

y $l$ puede estar dado por:

\begin{equation} l = \left[
\begin{array}{ccc}
1 & 1 & 1\\
1 & -8 & 1\\
1 & 1 & 1
\end{array}\right]
\end{equation}

En este trabajo se utiliza un kernel de aproximaci\'on a la segunda derivada por medio del Laplaciano del Gaussiano \cite{sotak1989laplacian}, dado por la siguiente ecuaci\'on:

\begin{equation}
\operatorname{LoG}(x,y) = \frac{1}{\pi\sigma^4}\left(\frac{x^2+y^2}{2\sigma^2} - 1\right)e^{-\frac{x^2+y^2}{2\sigma^2}},
\end{equation}


\subsection{Eliminaci\'on de ruido}

\subsubsection{Ruido Gaussiano Aditivo}

El ruido Gaussiano recibe este nombre debido a que est\'a modelado por la funci\'on de densidad de probabilidad Gaussiana correspondiente a la se\~nal de entrada. El modelo Gaussiano se considera como el m\'as adecuado para la representaci\'on de ruido en im\'agenes y est\'a dado por la ecuaci\'on \ref{eq:modelruido}, donde $X$ corresponde a la imagen sin ruido y el t\'ermino $V$ corresponde a la funci\'on de densidad de probabilidad dada por la ecuaci\'on \ref{eq:probfuncgauus}.

\begin{equation}
\label{eq:modelruido}
U = X + V
\end{equation}

\begin{equation}
\label{eq:probfuncgauus}
P(V(x)) = \frac{1}{{\sigma \sqrt {2\pi } }}e^{{{ - \left( {V(x) - \mu } \right)^2 } \mathord{\left/ {\vphantom {{ - \left( {x - \mu } \right)^2 } {2\sigma ^2 }}} \right. \kern-\nulldelimiterspace} {2\sigma ^2 }}}
\end{equation}


\subsubsection{Filtro Non-Local Means}

El filtro NLM forma parte de los filtros de pesado que pueden definirse de manera general por la siguiente ecuaci\'on:

\begin{equation}
\label{eq:weighted}
Y(U,p,m)=\left(\sum_{m\in \Omega}\psi_{i}\left(U, p, m\right)\right)^{-1} \\ \left(\sum_{m\in \Omega}\psi_{i}\left(U, p, m\right)U(m)\right),
\end{equation}

Donde $p$ y $m$ son pixeles contenidos en una ventana deslizante $\Omega$ de la imagen de entrada $U$ \cite{calderon2015dewaff}.
El filtro NLM define la funci\'on de pesado $\psi$ mediante la distancia Euclidiana para determinar la similitud entre vecindarios de dos pixeles $p_{1}=\left(x_{1},y_{1}\right)$
y $p_{2}=\left(x_{2},y_{2}\right)$ , de esta manera se determina el pondeado en una regi\'on dada por una ventana $\omega$ para asignarle el peso correspondiente al pixel reduciendo los cambios bruscos a la vez que se conservan los bordes y detalles, tomando como punto de partida que la localidad est\'a relacionada con la similitud de los patrones. La funci\'on de pesado del filtro NLM se expresa de la siguiente manera:

\begin{equation}
\label{eq:nlmfunc}
\[
\psi_{\textrm{NLM}}\left[\left[u,v\right],\left[x,y\right]\right]=\exp\left(-\frac{\left\Vert \vec{\eta}\left[x,y\right]-\vec{\eta}\left[u,v\right]\right\Vert }{2\sigma_{r}^{2}}\right).
\]
\end{equation}

\subsubsection{Filtro Deceived Non-Local Means}

El filtro Deceived Non-Local Means (DNLM) presenta un enfoque el cual consiste en la combinaci\'on de un m\'etodo de Undsharp Masking (USM) con el filtro Non Local Means, con el fin de lograr una mejora en los bordes y en el contraste de la imagaen, as\'i como la eliminaci\'on del Gausiano  presente en la imagen. La combinaci\'on propuesta se basa en el desacople entre la imagen para el pesado (imagen original $U$) y la utilizada en el filtrado $U_{USM}$. Esto permite evitar el efecto anillo presente en las im\'agenes filtradas con el USM \cite{calderon2015dewaff}. La siguientes ecuaciones presentan la definici\'on del enfoque de desacoplamiento y la funci\'on de pesado del filtro DNLM respectivamente:

\begin{equation}
\label{eq:dnlm}
Y(p)=\left(\sum_{m\in \Omega}\psi_{i}\left(U, p, m\right)\right)^{-1} \\ \left(\sum_{m\in \Omega}\psi_{i}\left(U, p, m\right)U_{USM}(m)\right),
\end{equation}


\begin{equation}
	\psi_{\text{NLM}}(p,m) =  exp\left(-\frac{ \left\| \displaystyle\ \overrightarrow{\eta}(\omega_{a},m) - \overrightarrow{\eta}(\omega_{a},p)  \right\|^{2}}{h}\right) 
\end{equation}


En cuanto a la complejidad computacional del filtro, para el peor escenario de usar una ventana $|\Omega| = N$ y un vecindario de tama\~no $\omega_{a} \times \omega_{a} = N$ pixeles, la complejidad computacional del filtro DNLM es de $O(N^3)$, donde $N$ corresponde a el n\'umero total de pixeles de la imagen de entrada $U$. 

\subsection{Optimizaciones computacionales}

Al analizar la distancia Euclidiana entre los vecindarios se tiene:

\begin{equation}
D\left(i,j\right)=\sum_{u}\left(\varPhi_{i}\left(u\right)-\varPhi_{j}\left(u\right)\right)^{2} \enspace ,
\end{equation}
 donde $\sum_{u}$ denota la sumatoria de los valores dados por la diferencia entre los vecindarios $\varPhi_i$ and $\varPhi_j$.

Al desarrollar la diferencia cuadrada y al reescribir los t\'erminos cuadr\'aticos como $\varPhi_{i}^{2}=\sum_{u}\varPhi_{i}\left(u\right)^{2} \enspace$,  se obtiene: 
\begin{equation}
 D\left(i,j\right)=\varPhi_{i}^{2}-2\sum_{u}\varPhi_{j}\left(u\right)\varPhi_{i}\left(u\right)+\varPhi_{j}^{2}  \enspace ,
 \label{eq_cuadratica}
\end{equation}


\begin{equation}
D\left(i,j\right)=\varPhi_{i}^{2}-2\varPhi_{j}\cdot\varPhi_{i}+\varPhi_{j}^{2} \enspace ,
\end{equation}
donde $\varPhi_{j}\cdot\varPhi_{i}$ corresponde al producto punto entre matrices. El siguiente ejemplo ilustra el c\'alculo de la distancia Euclideana entre los vecindarios de pixeles contenidos en la imagen $U\in\mathbb{R}^{5\times5}$ definida en la Tabla \ref{tab_ImageExample}.


\begin{table}
\begin{center}
\caption{Ejemplo de imagen $U$.}

\renewcommand{\arraystretch}{1.4}
\setlength\tabcolsep{3pt}

{
\begin{tabular}{cc|ccc|c}
 & \multicolumn{1}{c}{\textbf{1}} & \textbf{2} & \textbf{3} & \multicolumn{1}{c}{\textbf{4}} & \textbf{5}\tabularnewline
\textbf{1} & \multicolumn{1}{c}{5} & 12 & 1 & \multicolumn{1}{c}{3} & 2\tabularnewline
\cline{3-5} 
\textbf{2} & 5 & 2 & 3 & 1 & 4\tabularnewline
\textbf{3} & 3 & 1 & \textbf{2} & 3 & 1\tabularnewline
\textbf{4} & 4 & 3 & 2 & 1 & 3\tabularnewline
\cline{3-5} 
\textbf{5} & \multicolumn{1}{c}{1} & 5 & 6 & \multicolumn{1}{c}{5} & 3\tabularnewline
\end{tabular}
}
\par\end{center} \label{tab_ImageExample}
\end{table}
Para efectos de la ilustraci\'on, se toma una ventana $\Omega_{\left(3,3\right)}\in\mathbb{R}^{3\times3}$  y se realiza  el c\'alculo de la distancia Euclidiana entre los vecindarios $\varPhi_{\left(3,3\right)}$ y $\varPhi_{\left(2,2\right)}$:

\begin{equation}
\label{eq:resultado1}
\begin{array}{c}
\left\Vert \varPhi_{\left(3,3\right)}-\varPhi_{\left(2,2\right)}\right\Vert ^{2}=\left\Vert \begin{array}{ccc}
2 & 3 & 1\\
1 & 2 & 3\\
3 & 2 & 1
\end{array}-\begin{array}{ccc}
5 & 12 & 1\\
5 & 2 & 3\\
3 & 1 & 2
\end{array}\right\Vert\end{array}
=10.3923^{2}=108 \enspace .
\end{equation}



 Dado el desarrollo de la diferencia cuadr\'atica entre los vecindarios en la parte derecha de la ecuaci\'on, se puede obtener el c\'alculo utilizando la imagen integral de la matriz conformada por la operaci\'on cuadr\'atica de los elementos de la matriz $U\in\mathbb{R}^{5\times5}$. De esta manera permite calcular la distancia Euclideana para obtener: 
\begin{equation}
\left\Vert \varPhi_{\left(3,3\right)}-\varPhi_{\left(2,2\right)}\right\Vert =\varPhi_{\left(3,3\right)}^{2}-2\varPhi_{\left(2,2\right)}\cdot\varPhi_{\left(3,3\right)}+\varPhi_{\left(2,2\right)}^{2} 
\end{equation}


\begin{equation}
=\sum\left(\begin{array}{ccc}
4 & 9 & 1\\
1 & 4 & 9\\
9 & 4 & 1
\end{array}\right)-2\left(\begin{array}{ccc}
2 & 3 & 1\\
1 & 2 & 3\\
3 & 2 & 1
\end{array}\cdot\begin{array}{ccc}
5 & 12 & 1\\
5 & 2 & 3\\
3 & 1 & 2
\end{array}\right)
+\sum\left(\begin{array}{ccc}
25 & 144 & 1\\
25 & 4 & 9\\
9 & 1 & 4
\end{array}\right)
\end{equation}



\begin{equation}
=42+-2\cdot78+222=42-156+222=108\label{eq:cuadrados-1} \enspace ,
\end{equation}
consistente con los resultados obtenidos en la ecuaci\'on \ref{eq:resultado1}.




La optimizaci\'on de este algoritmo se centra en el c\'alculo de la distancia Euclidiana definida en la Ecuaci\'on \ref{eq_cuadratica} de la siguiente manera:
\begin{itemize}
\item El uso de la imagen integral cuadrada para calcular los t\'erminos $\varPhi_{i}^{2}$
y $\varPhi_{j}^{2}$.
\item Calcular la Transformada de Fourier para obtener el t\'ermino $-2\varPhi_{j}\cdot\varPhi_{i}$
correspondiente a la autocorrelaci\'on con la se\~nal
$\varPhi_{j}$.
\end{itemize}
 
\subsection{Im\'agenes integrales}


La imagen integral $I$ es definida en \cite{viola2001robust}, con una notaci\'on de barrido por pixel $i=(x,y)$, dada por: 
\begin{equation}
I_{\Sigma}\left(x,y\right)=\sum_{u\leq x,v\leq y}I\left(u,v\right) \enspace ,
\end{equation}
la cual corresponde a la sumatoria de los  pixeles ubicados a la izquierda y superiores al pixel $i=(x,y)$.
Continuando con el ejemplo previamente mostrado, la imagen integral para la matriz $U$ con sus elementos al cuadrado se calcula como se muestra en la Tabla \ref{tab_ImagenesIntegrales}. 
\begin{table}
\caption{Imagen integral para $U^2$.}
\begin{center}
\renewcommand{\arraystretch}{1.4}
\setlength\tabcolsep{3pt}


{
\begin{tabular}{cc|ccc|c}
 & \multicolumn{1}{c}{\textbf{1}} & \textbf{2} & \textbf{3} & \multicolumn{1}{c}{\textbf{4}} & \textbf{5}\tabularnewline
\textbf{1} & \multicolumn{1}{c}{\textbf{25(A)}} & 169 & 170 & \multicolumn{1}{c}{\textbf{179(B)}} & 183\tabularnewline
\cline{3-5} 
\textbf{2} & 50 & 198 & 208 & 218 & 238\tabularnewline
\textbf{3} & 59 & 208 & \textbf{222} & 241 & 262\tabularnewline
\textbf{4} & \textbf{75(C)} & 233 & 251 & \textbf{271(D)} & 301\tabularnewline
\cline{3-5} 
\textbf{5} & \multicolumn{1}{c}{76} & 259 & 313 & \multicolumn{1}{c}{358} & 397\tabularnewline
\end{tabular}
}


\par\end{center}
\label{tab_ImagenesIntegrales}
\end{table}
Para un c\'alculo eficiente de la sumatoria del \'area de una regi\'on de la imagen, se debe notar que: 
\begin{equation}
I_{\Sigma}\left(x,y\right)=I\left(x,y\right)-I_{\Sigma}\left(x-1,y-1\right)+I_{\Sigma}\left(x,y-1\right)
\\+I_{\Sigma}\left(x-1,y\right) \enspace ,
\end{equation}
lo cual, para el ejemplo anterior significa:
\begin{equation}
I_{\Sigma}\left(3,3\right)=4-198+208+208=222 \enspace .
\end{equation}
Al utilizar la imagen integral para calcular la sumatoria de una regi\'on de la imagen original, limitada por los pixeles $A=\left(x_{0},y_{0}\right)$,
$B=\left(x_{1},y_{0}\right)$, $C=\left(x_{0},y_{1}\right)$ and $D=\left(x_{1},y_{1}\right)$, como se ilustra en la Tabla \ref{tab_ImagenesIntegrales}, se calcula de la siguiente manera: 

\begin{equation}
\sum_{x_{0}<x\leq x_{1},y_{0}<y\leq y_{1}}I\left(x,y\right)=I\left(D\right)+I\left(A\right)-I\left(B\right)-I\left(C\right) \enspace ,
\end{equation}
y para el ejemplo presentado para una ventana de dimensiones $3\times3$ alrededor del pixel $(3,3)$ los pixeles de las esquinas est\'an dados por: $A=\left(1,1\right)$, $B=\left(4,1\right)$,
$C=\left(1,4\right)$ y $D=\left(4,4\right)$, como se especifica en la Tabla \ref{tab_ImagenesIntegrales}. De esta manera, el c\'alculo de la sumatoria de los pixeles en una ventana est\'a dada por: 

\begin{equation}
\sum_{x_{0}<x\leq x_{1},y_{0}<y\leq y_{1}}I\left(3,3\right)=271+25-179-75=42 \enspace ,
\end{equation}

con lo cual, es consistente con el primer t\'ermino de la Ecuaci\'on \ref{eq:cuadrados-1}. 

La incorporaci\'on de la imagen integral para la sumatoria del \'area de una ventana para una imagen de entrada con $c$ pixeles, presenta una complejidad computacional de $O(c)$, y s\'olamente debe ser calculada una vez en el filtro DNLM.


\subsection{Transformada R\'apida de Fourier}

Como se monstr\'o anteriormente, el t\'ermino en la ecuaci\'on cuadr\'atica de la distancia Euclideana entre los vecindarios de los pixeles $i$ y $j$:
\begin{equation}
S\left(i,j\right)=N_{i}^{2}-2\sum_{a=0}^{m-1}\sum_{b=0}^{m-1}N_{j}\left(a,b\right)N_{i}\left(a,b\right)+N_{j}^{2} =N_{i}^{2}-2N_{j}\cdot N_{i}+N_{j}^{2} \enspace , 
\end{equation}



correspondiente al producto punto de las matrices $-2N_{j}\cdot N_{i}$,  puede ser calculado utilizando la FFT con una complejidad computacional logar\'itmica, reduciendo la funci\'on de costo del filtro DNLM. 

\subsection{Paralelizaci\'on}

\subsection{Arquitectura Intel Xeon Phi Knights Landing}